---
/**
 * Signup Page
 *
 * Strona rejestracji nowego użytkownika.
 * Server-side sprawdza czy użytkownik już zalogowany (redirect na /).
 */

import AuthLayout from "@/layouts/AuthLayout.astro";
import { SignupForm } from "@/components/auth";
import { createSupabaseServerInstance } from "@/db/supabase.client";

// SSR wymagane dla sprawdzenia sesji
export const prerender = false;

// Server-side logic: Check if user is already logged in
const supabase = createSupabaseServerInstance({
  cookies: Astro.cookies,
  headers: Astro.request.headers,
});

const {
  data: { user },
} = await supabase.auth.getUser();

// If user is already authenticated, redirect to dashboard
if (user) {
  return Astro.redirect("/");
}

// Handle URL params for error/success messages
const errorParam = Astro.url.searchParams.get("error");
const successParam = Astro.url.searchParams.get("success");
---

<AuthLayout title="Rejestracja - Szybkie Kalorie">
  <SignupForm client:load />
</AuthLayout>
